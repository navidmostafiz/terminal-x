var DEV=!1,sock=io.connect(),bodyDOM=document.getElementsByTagName("BODY")[0],usernameDOM=document.getElementById("usernameID"),tokenDOM=document.getElementById("tokenID"),outputDOM=document.getElementById("outputID"),inputDOM=document.getElementById("inputID"),username="",token="",msg="",room_name="";function addLink(e,t){var n=document.createElement("BR"),o=document.createElement("a");o.setAttribute("href",t),o.setAttribute("target","_blank");var u=document.createTextNode(decryptedMSG(t));o.appendChild(u),outputDOM.appendChild(n),outputDOM.appendChild(o)}function youtube_parser(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);return!(!t||11!=t[7].length)&&t[7]}function addYoutubeLink(e,t){var n=document.createElement("P");n.style.margin=0;var o=document.createTextNode(e+": "+decryptedMSG(t));n.appendChild(o);var u="https://img.youtube.com/vi/"+youtube_parser(t)+"/0.jpg",a=document.createElement("a");a.setAttribute("href",t),a.setAttribute("target","_blank");var r=document.createElement("IMG");r.setAttribute("src",u),r.setAttribute("height",100),a.appendChild(r),outputDOM.appendChild(n),outputDOM.appendChild(a)}function addText(e,t){var n=document.createElement("P");n.style.margin=0;var o=document.createTextNode(e+": "+decryptedMSG(t));n.appendChild(o),outputDOM.appendChild(n)}function getDataType(e){return e.includes("youtube")?"youtubeLink":e.includes(".com")||e.includes(".net")||e.includes(".org")?"link":"text"}function sendToServer(e,t){logit("LOG: [EVENT=message_to_server] [room_name="+t+"] [from="+username+"] [msg="+e+"]"),sock.emit("message_to_server",{room_name:t,from:username,msg:e})}function decryptedMSG(e){return e}function logit(e){DEV&&console.log(e)}function encryptedMSG(e){return e}function removeElement(e){e.value="",e.blur(),toggleShow(e)}function toggleShow(e){"none"===e.style.display?e.style.display="block":e.style.display="none"}function makeinputDOMFocus(){outputDOM.blur,inputDOM.focus()}usernameDOM.focus(),toggleShow(tokenDOM),toggleShow(outputDOM),toggleShow(inputDOM),sock.on("message_to_client",(function({from:e,msg:t}){switch(logit("LOG: [EVENT=message_to_client] [room_name="+room_name+"] [from="+e+"] [msg="+t+"]"),getDataType(t)){case"youtubeLink":addYoutubeLink(e,t);break;case"link":addLink(e,t);break;case"text":addText(e,t);break;default:addText(e,t)}})),usernameDOM.addEventListener("keyup",(function(e){13===e.keyCode&&(e.preventDefault(),""!=usernameDOM.value?(username=usernameDOM.value,removeElement(usernameDOM),toggleShow(tokenDOM),tokenDOM.focus(),inputDOM.placeholder="say something "+username):(usernameDOM.placeholder="admin: what was that?",setTimeout(()=>{usernameDOM.placeholder="enter username"},1e3)))})),tokenDOM.addEventListener("keyup",(function(e){13===e.keyCode&&(e.preventDefault(),""!=tokenDOM.value?(token=tokenDOM.value,room_name=token,sock.emit("join_room",room_name),removeElement(tokenDOM),toggleShow(outputDOM),toggleShow(inputDOM),inputDOM.focus()):(tokenDOM.placeholder="admin: what was that?",setTimeout(()=>{tokenDOM.placeholder="enter secret token"},1e3)))})),inputDOM.addEventListener("keyup",(function(e){13===e.keyCode&&(e.preventDefault(),""!=inputDOM.value?(sendToServer(inputDOM.value,token),inputDOM.value=""):(inputDOM.placeholder="admin: what was that?",setTimeout(()=>{inputDOM.placeholder="say something "+username},1e3)))})),inputDOM.onmouseout=makeinputDOMFocus,outputDOM.onmouseenter=makeinputDOMFocus,outputDOM.onclick=makeinputDOMFocus,bodyDOM.onmouseenter=makeinputDOMFocus,bodyDOM.onclick=makeinputDOMFocus;
